<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Publications | AESD Lab</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>body{font-family:'Inter',sans-serif}</style>
</head>
<body class="bg-gray-50 text-gray-800">
<!-- Desktop nav -->
<div class="hidden md:flex items-center gap-6 text-gray-600">
  <a href="index.html#home" class="hover:text-blue-600">Home</a>
  <a href="research.html" class="hover:text-blue-600">Research</a>
  <a href="teaching.html" class="hover:text-blue-600">Teaching</a>
  <a href="publications.html" class="hover:text-blue-600">Publications</a>
  <a href="index.html#news" class="hover:text-blue-600">News</a>
  <a href="index.html#join" class="hover:text-blue-600">Join Us</a>
  <a href="index.html#contact" class="hover:text-blue-600">Contact</a>
</div>

<!-- Mobile menu -->
<div id="mobile-menu" class="hidden md:hidden px-6 pb-4 space-y-2">
  <a href="index.html#home" class="block text-gray-600 hover:text-blue-600">Home</a>
  <a href="research.html" class="block text-gray-600 hover:text-blue-600">Research</a>
  <a href="teaching.html" class="block text-gray-600 hover:text-blue-600">Teaching</a>
  <a href="publications.html" class="block text-gray-600 hover:text-blue-600">Publications</a>
  <a href="index.html#news" class="block text-gray-600 hover:text-blue-600">News</a>
  <a href="index.html#join" class="block text-gray-600 hover:text-blue-600">Join Us</a>
  <a href="index.html#contact" class="block text-gray-600 hover:text-blue-600">Contact</a>
</div>

  <main class="container mx-auto px-6">
    <section class="py-14">
      <h1 class="text-4xl md:text-5xl font-black">Publications</h1>
      <p class="mt-4 max-w-3xl text-lg text-gray-600">
        Search, filter by year/area, and export BibTeX. Data loads from <code>data/publications.json</code>.
      </p>
    </section>

    <!-- Controls -->
    <section class="py-4 bg-white rounded-xl border shadow-sm px-4 md:px-6">
      <div class="grid md:grid-cols-4 gap-4 items-end">
        <div>
          <label class="block text-sm text-gray-600">Search</label>
          <input id="q" type="text" placeholder="title / author / venue"
                 class="mt-1 w-full rounded-lg border-gray-300 focus:ring-blue-600 focus:border-blue-600"/>
        </div>
        <div>
          <label class="block text-sm text-gray-600">Year</label>
          <select id="year" class="mt-1 w-full rounded-lg border-gray-300 focus:ring-blue-600 focus:border-blue-600">
            <option value="">All</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-600">Area</label>
          <select id="area" class="mt-1 w-full rounded-lg border-gray-300 focus:ring-blue-600 focus:border-blue-600">
            <option value="">All</option>
          </select>
        </div>
        <div class="flex gap-2">
          <button id="exportVisible" class="mt-6 inline-block bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-blue-700">Export Visible as BibTeX</button>
          <a id="downloadLink" class="mt-6 hidden text-blue-700 underline">Download .bib</a>
        </div>
      </div>
    </section>

    <!-- List -->
    <section class="py-8">
      <ol id="list" class="space-y-5 list-decimal list-inside"></ol>
    </section>
  </main>

  <footer class="bg-gray-900 text-white mt-16">
    <div class="container mx-auto px-6 py-6 text-center">© <span id="year"></span> AESD Lab, SIT.</div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    let PUBS=[];

    function toBibtex(p){
      const key = ((p.authors||'').split(',')[0]||'aarya').split(' ')[0].replace(/[^A-Za-z]/g,'') + (p.year||'xxxx');
      const f = [];
      f.push('  author = {'+(p.authors||'')+'}');
      f.push('  title = {'+(p.title||'')+'}');
      f.push('  year = {'+(p.year||'')+'}');
      f.push('  journal = {'+(p.venue||'')+'}');
      if(p.volume) f.push('  volume = {'+p.volume+'}');
      if(p.issue)  f.push('  number = {'+p.issue+'}');
      if(p.pages)  f.push('  pages = {'+p.pages+'}');
      if(p.links && p.links.doi) f.push('  doi = {'+p.links.doi+'}');
      return '@article{'+key+',\\n'+f.join(',\\n')+'\\n}\\n';
    }

    function render(){
      const q = document.getElementById('q').value.toLowerCase();
      const y = document.getElementById('year').value;
      const a = document.getElementById('area').value;

      const wrap = document.getElementById('list');
      wrap.innerHTML = '';

      const filtered = PUBS
        .filter(p => !y || String(p.year)===y)
        .filter(p => !a || (p.area||'').toLowerCase()===a.toLowerCase())
        .filter(p => !q || (p.title+' '+p.authors+' '+p.venue).toLowerCase().includes(q))
        .sort((x,y)=>(y.year||0)-(x.year||0));

      // populate filters once
      const ySel = document.getElementById('year');
      if (ySel.options.length<=1) {
        [...new Set(PUBS.map(p=>String(p.year||'')).filter(Boolean))]
          .sort((a,b)=>Number(b)-Number(a))
          .forEach(v => { const o=document.createElement('option'); o.value=v; o.textContent=v; ySel.appendChild(o); });
      }
      const aSel = document.getElementById('area');
      if (aSel.options.length<=1) {
        [...new Set(PUBS.map(p=>(p.area||'').trim()).filter(Boolean))]
          .sort()
          .forEach(v => { const o=document.createElement('option'); o.value=v; o.textContent=v; aSel.appendChild(o); });
      }

      filtered.forEach((p,i)=>{
        const li = document.createElement('li');
        li.className = 'text-gray-800';
        li.innerHTML = `
          <div><span class="font-semibold">${p.authors||''}</span> (${p.year||''}). ${p.title||''}. <span class="italic">${p.venue||''}</span>${p.volume? ' '+p.volume:''}${p.issue?'('+p.issue+')':''}${p.pages?', '+p.pages:''}.</div>
          <div class="text-sm mt-1">
            ${p.links && p.links.doi ? `<a class="text-blue-700 hover:underline" target="_blank" href="${p.links.doi}">DOI</a>`:''}
            ${p.links && p.links.pdf ? ` · <a class="text-blue-700 hover:underline" target="_blank" href="${p.links.pdf}">PDF</a>`:''}
            ${p.area ? ` · <span class="text-gray-500">Area: ${p.area}</span>`:''}
            <button data-idx="${i}" class="ml-3 text-xs rounded border px-2 py-0.5 hover:bg-gray-50">BibTeX</button>
          </div>`;
        wrap.appendChild(li);
      });

      // item bibtex
      wrap.querySelectorAll('button[data-idx]').forEach(btn=>{
        btn.onclick = () => {
          const i = Number(btn.getAttribute('data-idx'));
          const bib = toBibtex(filtered[i]);
          const blob = new Blob([bib], {type:'text/plain'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'citation.bib'; a.click();
          URL.revokeObjectURL(url);
        };
      });

      // export all visible
      document.getElementById('exportVisible').onclick = () => {
        const all = filtered.map(toBibtex).join('\n');
        const blob = new Blob([all], {type:'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.getElementById('downloadLink');
        a.classList.remove('hidden');
        a.href = url; a.download = 'publications_visible.bib';
        a.textContent = 'Download .bib';
      };
    }

    fetch('data/publications.json')
      .then(r => r.json())
      .then(data => { PUBS = data; render(); })
      .catch(err => { 
        console.error('Failed to load publications.json', err);
        document.getElementById('list').innerHTML = '<li class="text-red-600">Could not load data/publications.json</li>';
      });

    ['q','year','area'].forEach(id => document.getElementById(id).addEventListener('input', render));
  </script>
</body>
</html>
