<!DOCTYPE html>
<html lang="en">
<!-- Header (paste this at the top of every page) -->
<header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
  <nav class="container mx-auto px-6 py-4">
    <div class="flex items-center gap-6">
      <!-- Brand stays on the left -->
      <a href="index.html#home" class="shrink-0 text-base md:text-lg font-extrabold tracking-tight text-gray-900">
        Advanced Electronics &amp; Sensor Devices Lab
      </a>
      <!-- Page links LEFT-aligned (remove justify-between / ml-auto) -->
      <div class="hidden md:flex items-center gap-6 text-gray-700">
        <a href="index.html#home" class="hover:text-blue-600">Home</a>
        <a href="research.html" class="hover:text-blue-600">Research</a>
        <a href="teaching.html" class="hover:text-blue-600">Teaching</a>
        <a href="publications.html" class="hover:text-blue-600">Publications</a>
        <a href="index.html#news" class="hover:text-blue-600">News</a>
        <a href="index.html#join" class="hover:text-blue-600">Join Us</a>
        <a href="index.html#contact" class="hover:text-blue-600">Contact</a>
      </div>

      <!-- Mobile button (kept at far right) -->
      <button id="mobile-menu-button" class="md:hidden ml-auto p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7" />
        </svg>
      </button>
    </div>
    <!-- Mobile menu (links mirror desktop) -->
    <div id="mobile-menu" class="hidden md:hidden mt-3 space-y-2">
      <a href="index.html#home" class="block text-gray-700 hover:text-blue-600">Home</a>
      <a href="research.html" class="block text-gray-700 hover:text-blue-600">Research</a>
      <a href="teaching.html" class="block text-gray-700 hover:text-blue-600">Teaching</a>
      <a href="publications.html" class="block text-gray-700 hover:text-blue-600">Publications</a>
      <a href="index.html#news" class="block text-gray-700 hover:text-blue-600">News</a>
      <a href="index.html#join" class="block text-gray-700 hover:text-blue-600">Join Us</a>
      <a href="index.html#contact" class="block text-gray-700 hover:text-blue-600">Contact</a>
    </div>
  </nav>
</header>

    <!-- Controls -->
    <section class="py-4 bg-white rounded-xl border shadow-sm px-4 md:px-6">
      <div class="grid md:grid-cols-4 gap-4 items-end">
        <div>
          <label class="block text-sm text-gray-600">Search</label>
          <input id="q" type="text" placeholder="title / author / venue"
                 class="mt-1 w-full rounded-lg border-gray-300 focus:ring-blue-600 focus:border-blue-600"/>
        </div>
        <div>
          <label class="block text-sm text-gray-600">Year</label>
          <select id="year" class="mt-1 w-full rounded-lg border-gray-300 focus:ring-blue-600 focus:border-blue-600">
            <option value="">All</option>
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-600">Area</label>
          <select id="area" class="mt-1 w-full rounded-lg border-gray-300 focus:ring-blue-600 focus:border-blue-600">
            <option value="">All</option>
          </select>
        </div>
        <div class="flex gap-2">
          <button id="exportVisible" class="mt-6 inline-block bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow hover:bg-blue-700">Export Visible as BibTeX</button>
          <a id="downloadLink" class="mt-6 hidden text-blue-700 underline">Download .bib</a>
        </div>
      </div>
    </section>

    <!-- List -->
    <section class="py-8">
      <ol id="list" class="space-y-5 list-decimal list-inside"></ol>
    </section>
  </main>

  <footer class="bg-gray-900 text-white mt-16">
    <div class="container mx-auto px-6 py-6 text-center">© <span id="year"></span> AESD Lab, SIT.</div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    let PUBS=[];

    function toBibtex(p){
      const key = ((p.authors||'').split(',')[0]||'aarya').split(' ')[0].replace(/[^A-Za-z]/g,'') + (p.year||'xxxx');
      const f = [];
      f.push('  author = {'+(p.authors||'')+'}');
      f.push('  title = {'+(p.title||'')+'}');
      f.push('  year = {'+(p.year||'')+'}');
      f.push('  journal = {'+(p.venue||'')+'}');
      if(p.volume) f.push('  volume = {'+p.volume+'}');
      if(p.issue)  f.push('  number = {'+p.issue+'}');
      if(p.pages)  f.push('  pages = {'+p.pages+'}');
      if(p.links && p.links.doi) f.push('  doi = {'+p.links.doi+'}');
      return '@article{'+key+',\\n'+f.join(',\\n')+'\\n}\\n';
    }

    function render(){
      const q = document.getElementById('q').value.toLowerCase();
      const y = document.getElementById('year').value;
      const a = document.getElementById('area').value;

      const wrap = document.getElementById('list');
      wrap.innerHTML = '';

      const filtered = PUBS
        .filter(p => !y || String(p.year)===y)
        .filter(p => !a || (p.area||'').toLowerCase()===a.toLowerCase())
        .filter(p => !q || (p.title+' '+p.authors+' '+p.venue).toLowerCase().includes(q))
        .sort((x,y)=>(y.year||0)-(x.year||0));

      // populate filters once
      const ySel = document.getElementById('year');
      if (ySel.options.length<=1) {
        [...new Set(PUBS.map(p=>String(p.year||'')).filter(Boolean))]
          .sort((a,b)=>Number(b)-Number(a))
          .forEach(v => { const o=document.createElement('option'); o.value=v; o.textContent=v; ySel.appendChild(o); });
      }
      const aSel = document.getElementById('area');
      if (aSel.options.length<=1) {
        [...new Set(PUBS.map(p=>(p.area||'').trim()).filter(Boolean))]
          .sort()
          .forEach(v => { const o=document.createElement('option'); o.value=v; o.textContent=v; aSel.appendChild(o); });
      }

      filtered.forEach((p,i)=>{
        const li = document.createElement('li');
        li.className = 'text-gray-800';
        li.innerHTML = `
          <div><span class="font-semibold">${p.authors||''}</span> (${p.year||''}). ${p.title||''}. <span class="italic">${p.venue||''}</span>${p.volume? ' '+p.volume:''}${p.issue?'('+p.issue+')':''}${p.pages?', '+p.pages:''}.</div>
          <div class="text-sm mt-1">
            ${p.links && p.links.doi ? `<a class="text-blue-700 hover:underline" target="_blank" href="${p.links.doi}">DOI</a>`:''}
            ${p.links && p.links.pdf ? ` · <a class="text-blue-700 hover:underline" target="_blank" href="${p.links.pdf}">PDF</a>`:''}
            ${p.area ? ` · <span class="text-gray-500">Area: ${p.area}</span>`:''}
            <button data-idx="${i}" class="ml-3 text-xs rounded border px-2 py-0.5 hover:bg-gray-50">BibTeX</button>
          </div>`;
        wrap.appendChild(li);
      });

      // item bibtex
      wrap.querySelectorAll('button[data-idx]').forEach(btn=>{
        btn.onclick = () => {
          const i = Number(btn.getAttribute('data-idx'));
          const bib = toBibtex(filtered[i]);
          const blob = new Blob([bib], {type:'text/plain'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'citation.bib'; a.click();
          URL.revokeObjectURL(url);
        };
      });

      // export all visible
      document.getElementById('exportVisible').onclick = () => {
        const all = filtered.map(toBibtex).join('\n');
        const blob = new Blob([all], {type:'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.getElementById('downloadLink');
        a.classList.remove('hidden');
        a.href = url; a.download = 'publications_visible.bib';
        a.textContent = 'Download .bib';
      };
    }

    fetch('data/publications.json')
      .then(r => r.json())
      .then(data => { PUBS = data; render(); })
      .catch(err => { 
        console.error('Failed to load publications.json', err);
        document.getElementById('list').innerHTML = '<li class="text-red-600">Could not load data/publications.json</li>';
      });

    ['q','year','area'].forEach(id => document.getElementById(id).addEventListener('input', render));
  </script>
</body>
  <!-- Put this script once at the bottom of <body> on each page -->
<script>
  // Mobile menu
  const btn = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  if (btn && menu) btn.addEventListener('click', () => menu.classList.toggle('hidden'));

  // Close mobile after click
  if (menu) menu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => menu.classList.add('hidden')));

  // Highlight active link
  const path = location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('nav a').forEach(a => {
    const href = a.getAttribute('href'); if (!href) return;
    const file = (href.split('#')[0] || 'index.html');
    if (file === path) a.classList.add('text-blue-700','font-semibold');
  });
</script>
</html>
